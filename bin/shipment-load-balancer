#!/bin/bash
set -e

if [ "$1" == "_description" ]; then
  echo "Manage load balancer"
  exit
fi

CMD=$1
shift
case $CMD in
  start)
    ID=$(sudo docker ps | grep shipment-load-balancer | awk '{ print $1 }')
    if [ -z "$ID" ]; then
      sudo docker run -d -p 80:80 --name shipment-load-balancer -v /var/run/docker.sock:/tmp/docker.sock jwilder/nginx-proxy
      log "Load balancer started"
    else
      log "Load balancer already started"
    fi
    exit
    ;;
  stop)
    ID=$(sudo docker ps | grep shipment-load-balancer | awk '{ print $1 }')
    if [ -n "$ID" ]; then
      log "Stopping load balancer"
      shipment stop -i $ID
    else
      log "Load balancer not running"
    fi
    exit
    ;;
  restart)
    shipment load-balancer stop
    shipment load-balancer start
    exit
    ;;

esac

