#!/bin/bash
set -e

IDS=0

if [ "$1" == "_description" ]; then
  echo "List running apps"
  exit
fi

usage_running() {
  cat <<-EOF

  Usage: shipment running [options]

  Deploy options:

    -n <name>            name of app [some-cool-app]
    -i                   just return ids of running containers

EOF
}

while getopts ":in:h" OPTION "$@"; do
  case $OPTION in
    i) IDS=1;;
    n) NAME=$OPTARG;;
    h) HELP=1;;
  esac
done

if [ "$HELP" == 1 ]; then
  usage_running
  exit
fi

results=$(sudo docker ps | grep shipment/$NAME)

if [ "$IDS" == 0 ]; then
  echo $results | awk 'BEGIN {printf("%-30s %-20s \n" ,"IMAGE", "CONTAINER ID")} { printf("%-30s %-20s \n", $2, $1)}'
else
  echo $results | awk '{ print $1 }'
fi
